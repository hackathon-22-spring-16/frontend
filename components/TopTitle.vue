<script setup lang="ts">
import Vivus from 'vivus'

const props = defineProps<{
  animationStart: boolean
}>()
const titleStroke = ref<Vivus | null>(null)
onMounted(() => {
  nextTick(() => {
    setTitleBlurAnimation()
    titleStroke.value = new Vivus(
      'title-stroke',
      {
        type: 'sync',
        animTimingFunction: Vivus.EASE_OUT,
        duration: 800,
        start: 'manual',
      },
      () => {
        titleBlurAnimation?.play()
      }
    )
  })
})

const titleBlurRef = ref<HTMLImageElement | null>(null)
let titleBlurAnimation: Animation | null = null
const setTitleBlurAnimation = () => {
  if (titleBlurRef.value === null) {
    return
  }
  titleBlurAnimation = titleBlurRef.value.animate(
    [
      {
        opacity: 0,
      },
      {
        opacity: 1,
      },
    ],
    {
      duration: 800,
      easing: 'ease-out',
      fill: 'forwards',
    }
  )
  titleBlurAnimation.pause()
}

watch(
  () => props.animationStart,
  value => {
    if (value) {
      titleStroke.value?.play()
    } else {
      titleStroke.value?.reset()
    }
  }
)
</script>

<template>
  <client-only class="whole-wrapper">
    <div class="top-title-container">
      <img
        ref="titleBlurRef"
        :height="180"
        :width="700"
        src="@/assets/TitleBlur.svg"
        class="top-title-blur"
      />
      <svg
        id="title-stroke"
        width="700"
        height="180"
        viewBox="0 0 700 180"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M9 136.5H43.5V133H18V128H25.5L30 123.5V59L25.5 54.5H18.5V48.5H59.5L66.5 50.5L74 54.5L78 59.5L80 66V76L77 81L73 85L70 87L65.5 88.5L62.5 83.5L66 79.5L67.5 75.5V64.5L65 59L61.5 57L57 55.5H41.5V85.5H57.5L61 84L64.5 89L61 92.5C59.1667 92.1667 55.4 91.5 55 91.5C54.6 91.5 45.8333 91.5 41.5 91.5V127.5H55.5L61.5 126.5L67.5 123.5L70 119L70.5 116.5V101.5L68.5 97L66 95L62 93.5L66.5 90H70.5L74 92L77.5 95L81 100L82.5 103.5L83.5 107.5V115.5L82 120.5L78 125L73.5 129C72.1667 129.577 69.4 130.785 69 131C68.5 131.268 63.5 132.5 63 132.5C62.6 132.5 59.1667 132.833 57.5 133H45V136.5H110V133H94.5V128H100.5L103.5 126L105 123.5V80.5L103.5 77.5L100.5 75H94.5V70H112.5C113 72.5 114 77.6 114 78C114 78.4 114.667 80.8333 115 82L117.5 75.5L121 72L126 70L130 69H135L140.5 71.5L143.5 76V81L142 83.5L139 85.5H133.5L132.5 79.5L129.5 76.5H124.5L120.5 80.5C119.833 81.3333 118.5 83.1 118.5 83.5C118.5 83.9 117.167 88 116.5 90L115.5 93.5V123.5L117.5 126.5L119.5 127.5L120.5 128H128.5V133H111.5V136.5H166.5V134H163L158 132.5L154.5 129.5L151.5 125.5L149.5 120.5V109.5L153 104L158.5 100L164.5 97.5L173 96.5H180.5L185.5 96V81C184.833 79.6667 183.4 77 183 77C182.6 77 180.5 75.6667 179.5 75H170.5L167 77.5L164.5 81.5V88H158.5L156.5 85.5L154.5 82.5V77L158 73L163 70.5L168.5 69.5L173.5 69H179.5L186 70.5L190 73L193 76.5C194 77.8333 196 80.6 196 81C196 81.4 196.333 85.8333 196.5 88V122.5L197.5 126L200 128H204.5V133H188.5L186.5 122L184.5 117.5L185.5 115.5V101H175L168.5 102L163 106.5L160.5 111.5C160.5 114.5 160.5 120.6 160.5 121C160.5 121.4 162.833 123.833 164 125L166.5 127H174.5L179.5 125L182 122.5L183.5 119.5L185 123L183 126.5L179 130L174.5 133L169.5 134H168.5V136.5H228V133H212V128H219L222 126.5L223.5 123V80L221.5 76.5L218 75H213.5V70H227.5V58H225.5L223.5 56L221.5 53V48.5L223 45.5L225.5 44H231L233.5 46L234.5 48.5V54.5L232 56.5L230 58H228.5V70H234V122L235.5 125L238.5 127.5L240.5 128H245.5V133H229.5V136.5H264.5V133H250V128H256.5L260 126L261 123V80L258.746 76.5L255.5 75H250V70H269.5L270.5 75.5V80L273.5 75.5L278 72L284.5 69H295.5L301.5 72L306.5 77.5L309 83.5V124L311.5 126.5L315 128H318.5V133H298.5V87L296.5 81L292.5 77.5L289.5 76H282L277.5 78L274.5 81.5L272 87L271.5 90V123.5L273 126.5L278 128H281.5V133H266V136.5H387V133H370.5V128H378L381 126L382.5 123V54.5H369.5L366 55.5L363 59L361.5 62.5V70H355.5V49H421.5V70H416.5L415.5 62L413.5 57.5L411 55H394.5V123L396.5 126.5L398.5 128H406.5V133H388.5V136.5H456.5V134H453.5L448.5 132.5L443.5 129.5L440.5 125L438.5 120.5L437.5 117.5V80.1857L435.5 77L433 75H427.5V70H448V114.672L449 120.5L452.5 124.5L456.5 126.5H465L469 124.5L471.5 121L474 116.5L475 114L476 110V81.5L475 78L472 76L469.5 75H465.5V70H486V122L487 126L490 127.5L494.5 128H495.5V133H478L476.5 123H474.5L473 127L470 130L466 132L462 133.5L458 134V136.5H517.5V133H502.5V128H509L512 126L513 123V79.5L511 76.5L508 75H502.5V70H520.5L522.5 82H523.5L526.5 75.5L529.5 72.5L533.5 70L540 69H542L548.5 71L551 74V81L549.5 83.5L543.5 86H541.5L541 82L539.5 78L536.5 76H532.5L529 79L526.5 83L525.5 87L524.5 91.5L523.5 95V123L525 126L528.5 128H536V133H519V136.5H590.959L589 133L584 134H578.5L573 132L568.5 129L565.5 124L565 118V76.5H555.5V72L561 71.5L565 69L569 63L570.5 56H575.5V69.885H591V76.5H575.5V120.5L578 125.5L581.5 127.5H592V133H597V128L606 127L608 123V53.5L606 51L604 49H596.5V44H619V123.378L620.5 126.5L623.5 127.5H629.5V133H598.5V136.5H668.5L667 134H661L654.5 132L647 128L640.5 119.5L638 108V94.5L639.5 86L642 80.5L646 76L651 72L654.5 70.5L661.5 69H666.5L674 71L678.5 74L682 77L683.5 79.5L675 83L670.5 77.5L665 75H660L655.5 77.5L652.5 81.5L650.5 86.5L649 90.5L648.5 96H676.5L675.5 86L675 84L684.5 80.5L687.5 92.5V102H648.5V108.5L649.5 113.5L651.5 118.5L654.5 122.5L659 125.5L662.5 126.5H670L675 125.5L679 123.5L683 119.5H684.5L685 123L683.5 127.5L679 130.5L673.5 132.5L668.5 133.5L670.5 136.5H691.5"
          stroke="white"
        />
      </svg>
    </div>
  </client-only>
</template>

<style lang="scss">
.whole-wrapper {
  height: 180px;
  width: 700px;
}
.top-title-container {
  position: relative;
  text-align: center;
  width: fit-content;

  & > *:nth-child(n + 2) {
    position: absolute;
    top: 0;
    left: 0;
  }
}
</style>
